<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AI Project Plan: Auto-Rickshaw Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: The application is designed as an interactive dashboard. Users can explore the 8-week plan by phase, role, or timeline. Key interactions include role-based filtering and an interactive Gantt chart. This structure was chosen to make the dense plan digestible for beginners. Three Gemini-powered features were added: 1) Task Elaboration for on-demand detail, 2) Project Risk Analysis for high-level strategic insight, and 3) Related Task Suggestion for detailed planning within each phase. A task completion checkbox has been added for progress tracking. -->
    <!-- Visualization & Content Choices: 
        - Project Timeline: Report Info -> 8-week schedule. Goal -> Show change/duration. Viz -> Horizontal Bar Chart (Gantt-style). Interaction -> Hover for details. Justification -> Visually communicates phase duration and overlap. Library -> Chart.js (Canvas).
        - Role Tasks: Report Info -> Role responsibilities. Goal -> Organize/Filter. Presentation -> Dynamic list with completion state. Interaction -> Clickable role buttons to filter; checkboxes to mark complete. Justification -> Provides personalized to-do lists with progress tracking. Method -> Vanilla JS DOM manipulation.
        - Phase Breakdown: Report Info -> Weekly tasks grouped into phases. Goal -> Inform/Organize. Presentation -> Accordion cards. Interaction -> Click to expand/collapse. Justification -> Manages information density. Method -> HTML/CSS/JS.
        - âœ¨ AI Task Elaboration: Report Info -> Individual task titles. Goal -> Provide deeper understanding. Presentation -> Modal window. Interaction -> Click a button on a task card. Justification -> Offers expert-level detail on demand. Method -> Gemini API via JS Fetch.
        - âœ¨ AI Risk Analysis: Report Info -> Entire project task list. Goal -> Identify strategic risks. Presentation -> Modal window. Interaction -> Click a button in the section header. Justification -> Provides a high-level "second opinion" on the project plan. Method -> Gemini API via JS Fetch.
        - âœ¨ AI Task Suggestion: Report Info -> Phase title and summary. Goal -> Enhance planning. Presentation -> Modal window. Interaction -> Click a button within a phase card. Justification -> Helps teams brainstorm and cover all bases. Method -> Gemini API via JS Fetch.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .task-card {
            transition: all 0.3s ease-in-out;
            border-left-width: 4px;
        }
        .task-card.completed {
            opacity: 0.65;
            background-color: #f1f5f9; /* slate-100 */
        }
        .task-card.completed .task-content-wrapper {
            text-decoration: line-through;
            color: #64748b; /* slate-500 */
        }
        .task-card.completed .elaborate-btn {
            text-decoration: none !important;
        }
        .role-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-30 shadow-sm">
        <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-xl text-indigo-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 inline-block -mt-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 2a1 1 0 00-.707 1.707L8.586 6H4a1 1 0 000 2h4.586l-2.293 2.293A1 1 0 107.707 11.707l4-4a1 1 0 000-1.414l-4-4A1 1 0 007 2zM13 6a1 1 0 100-2 1 1 0 000 2zm-1 5a1 1 0 11-2 0 1 1 0 012 0zM13 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
                        AI Project Roadmap
                    </span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#overview" class="text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Overview</a>
                        <a href="#timeline" class="text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Timeline</a>
                        <a href="#roles" class="text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Roles & Tasks</a>
                        <a href="#phases" class="text-slate-600 hover:bg-indigo-50 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Phase Details</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <section id="overview" class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-bold tracking-tight text-slate-900 mb-4">AI Auto-Rickshaw Detection Project</h1>
            <p class="mt-4 max-w-3xl mx-auto text-lg text-slate-600">An interactive 8-week roadmap for a team of four beginners. Explore the project timeline, filter tasks by role, and use the integrated âœ¨ <strong class="font-semibold text-indigo-600">Gemini AI features</strong> to elaborate on tasks, analyze risks, and suggest new ideas.</p>
        </section>

        <section id="timeline" class="mb-16 bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-slate-900 mb-2">Project Timeline</h2>
            <p class="text-slate-600 mb-6">This chart provides a high-level overview of the project's 8-week duration, showing how different phases overlap and progress over time. Hover over the bars to see the key focus for each phase.</p>
            <div class="chart-container">
                <canvas id="timelineChart"></canvas>
            </div>
        </section>

        <section id="roles" class="mb-16">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
                <div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">Roles & Tasks</h2>
                    <p class="text-slate-600">Select a role to filter the task list, or use the AI-powered risk analysis to get strategic insights on the entire project plan.</p>
                </div>
                <button id="risk-analysis-btn" class="mt-4 sm:mt-0 flex-shrink-0 bg-rose-50 text-rose-600 hover:bg-rose-100 font-bold py-2 px-4 rounded-lg transition-colors">âœ¨ Analyze Project Risks</button>
            </div>
            <div id="role-filter-buttons" class="flex flex-wrap gap-3 mb-8 justify-center">
                <button data-role="all" class="role-btn active bg-indigo-600 text-white px-5 py-2 rounded-full font-semibold shadow-md hover:bg-indigo-700 transition-all duration-300">Show All Tasks</button>
                <button data-role="pm" class="role-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold shadow-md hover:bg-slate-100 transition-all duration-300">ðŸ‘¤ Project Manager</button>
                <button data-role="data" class="role-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold shadow-md hover:bg-slate-100 transition-all duration-300">ðŸ“Š Data Lead</button>
                <button data-role="model" class="role-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold shadow-md hover:bg-slate-100 transition-all duration-300">ðŸ¤– Model Lead</button>
                <button data-role="sim" class="role-btn bg-white text-slate-700 px-5 py-2 rounded-full font-semibold shadow-md hover:bg-slate-100 transition-all duration-300">ðŸ’» Simulation Lead</button>
            </div>
            <div id="task-list" class="space-y-4">
            </div>
        </section>
        
        <section id="phases" class="mb-16">
            <h2 class="text-2xl font-bold text-slate-900 mb-2">Phase Details</h2>
            <p class="text-slate-600 mb-6">The project is broken down into five distinct phases. Click on any phase to expand its details, and use the AI assistant to suggest additional tasks you might have missed.</p>
            <div id="phases-accordion" class="space-y-3">
            </div>
        </section>

    </main>
    
    <footer class="bg-white border-t border-slate-200">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500">
            <p>Interactive Project Plan with âœ¨ Gemini AI | Generated from Source Report</p>
        </div>
    </footer>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div id="modal-overlay" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 opacity-0"></div>
        <div id="modal-content" class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95">
            <div class="flex justify-between items-center p-4 border-b border-slate-200">
                <h3 id="modal-title" class="text-lg font-bold text-slate-900">Task Elaboration</h3>
                <button id="modal-close-btn" class="text-2xl leading-none text-slate-500 hover:text-slate-800">&times;</button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div id="modal-loader" class="flex justify-center items-center h-40">
                    <div class="loader"></div>
                </div>
                <div id="modal-text-content" class="text-slate-700 leading-relaxed prose"></div>
            </div>
        </div>
    </div>

<script>
const projectData = {
    tasks: [
        { week: 1, role: 'pm', title: 'Define Project Charter', description: 'Formalize the problem statement, scope, objectives, and deliverables.' },
        { week: 1, role: 'pm', title: 'Set Up Asana Board', description: 'Create the project board with columns: Backlog, To Do, In Progress, In Review, Done.' },
        { week: 1, role: 'pm', title: 'Establish Communication Channels', description: 'Set up a shared Google Drive and a group chat for the team.' },
        { week: 1, role: 'data', title: 'Conceptual Deep Dive', description: 'Learn the difference between Object Detection and Image Classification.' },
        { week: 1, role: 'model', title: 'Understand Neural Networks & YOLO', description: 'Study the basic concepts of NNs and the YOLO architecture.' },
        { week: 1, role: 'sim', title: 'Set Up Local Environment', description: 'Install Python, create a virtual environment, and install core libraries (ultralytics, opencv-python).' },
        { week: 2, role: 'data', title: 'Develop Data Collection Strategy', description: 'Plan the collection of diverse video data focusing on various lighting, angles, and occlusion.' },
        { week: 2, role: 'data', title: 'Document Collection Process', description: 'Maintain a Data_Collection_Log.csv with metadata for each video file.' },
        { week: 2, role: 'sim', title: 'Video Pre-processing & Frame Extraction', description: 'Use FFmpeg to extract frames from raw videos at a rate of 1 frame per second.' },
        { week: 3, role: 'pm', title: 'Set Up Roboflow Workspace', description: 'Create the Roboflow project and invite team members.' },
        { week: 3, role: 'data', title: 'Define Annotation Guidelines', description: 'Create a formal Annotation_Guidelines.md document with clear rules for labeling.' },
        { week: 3, role: 'data', title: 'Annotate the Dataset', description: 'Lead the team in labeling extracted frames using Roboflow, ensuring consistency.' },
        { week: 3, role: 'data', title: 'Perform Quality Control', description: 'Review a sample of annotations from each team member to ensure high quality.' },
        { week: 3, role: 'model', title: 'Apply Data Augmentation', description: 'Use Roboflow to generate an augmented dataset version with flips, rotations, and brightness changes.' },
        { week: 4, role: 'model', title: 'Export Dataset from Roboflow', description: 'Generate a new dataset version with a 70/20/10 split in YOLOv8 format.' },
        { week: 4, role: 'model', title: 'Set Up Training Notebook in Colab', description: 'Prepare a Google Colab notebook, mount Google Drive, and install necessary libraries.' },
        { week: 4, role: 'model', title: 'Run Initial Model Training', description: 'Start the first training run using transfer learning from yolov8n.pt for 50 epochs.' },
        { week: 4, role: 'pm', title: 'Document Training Runs', description: 'Maintain a shared Model_Performance_Log.csv to track all experiments and results.' },
        { week: 5, role: 'model', title: 'Analyze Model Performance Metrics', description: 'Evaluate mAP@50, Precision, and Recall from the training results.' },
        { week: 5, role: 'model', title: 'Identify Model Weaknesses', description: 'Visually analyze predictions to find common failure modes (e.g., small objects, occlusion).' },
        { week: 5, role: 'data', title: 'Refine Dataset Based on Analysis', description: 'Collect more specific data or add negative examples to address model weaknesses.' },
        { week: 5, role: 'sim', title: 'Prototype Simulation with OpenCV', description: 'Write a basic script to open a video file, display it frame by frame, and draw static shapes.' },
        { week: 6, role: 'sim', title: 'Develop Core Simulation Loop', description: 'Create a robust Python script to process video files frame-by-frame with user exit controls.' },
        { week: 6, role: 'model', title: 'Create Model Inference Module', description: 'Develop a Python function to load the best.pt model and perform detection on a single frame.' },
        { week: 6, role: 'sim', title: 'Integrate Detection into Simulation', description: 'Call the inference module from the main loop and process the detection results.' },
        { week: 6, role: 'sim', title: 'Visualize Detections', description: 'Use cv2.rectangle() and cv2.putText() to draw bounding boxes and labels on the video feed.' },
        { week: 7, role: 'sim', title: 'Define Region of Interest (ROI)', description: 'Implement a polygonal "danger zone" on the video frame to represent the vehicle\'s path.' },
        { week: 7, role: 'sim', title: 'Implement Collision Check Logic', description: 'Write logic to determine if a detected bounding box intersects with the ROI.' },
        { week: 7, role: 'sim', title: 'Visualize Avoidance Maneuver', description: 'Change the ROI color to red and display a warning text when a collision is detected.' },
        { week: 7, role: 'pm', title: 'Conduct System-wide Testing', description: 'Lead the team in testing the full application using a formal Test Case Log.' },
        { week: 8, role: 'sim', title: 'Code Refactoring and Commenting', description: 'Clean up the source code, remove magic numbers, and add docstrings.' },
        { week: 8, role: 'pm', title: 'Compile Final Project Report', description: 'Write the final report including methodology, results, and conclusion.' },
        { week: 8, role: 'sim', title: 'Create Demonstration Video', description: 'Record and edit a 2-3 minute video showcasing the final system.' },
        { week: 8, role: 'pm', title: 'Prepare and Rehearse Presentation', description: 'Create presentation slides and conduct team rehearsals for the final showcase.' },
    ],
    roles: {
        pm: { name: 'Project Manager', color: 'border-blue-500' },
        data: { name: 'Data Lead', color: 'border-emerald-500' },
        model: { name: 'Model Lead', color: 'border-purple-500' },
        sim: { name: 'Simulation Lead', color: 'border-orange-500' }
    },
    phases: [
        { 
            title: 'Part I: Project Initiation & Foundational Knowledge (Week 1)',
            summary: 'Establish the project framework, assign roles, set up tools, and ensure all team members understand the core concepts of AI and object detection.',
            deliverables: ['Project Charter', 'Asana Board', 'Shared Google Drive', 'Configured Development Environments']
        },
        { 
            title: 'Part II: Data Acquisition & Annotation (Weeks 2-3)',
            summary: 'The most critical phase focused on collecting a diverse set of video data and meticulously annotating it to create a high-quality custom dataset for training.',
            deliverables: ['Raw Video Collection', 'Annotated Dataset on Roboflow', 'Data Collection Log', 'Annotation Guidelines']
        },
        { 
            title: 'Part III: Model Development & Evaluation (Weeks 4-5)',
            summary: 'Transition from data preparation to core machine learning. This phase involves training the first custom model, analyzing its performance, and iteratively refining it.',
            deliverables: ['Trained YOLOv8 Model (best.pt)', 'Model Performance Log', 'Analysis of Failure Modes']
        },
        { 
            title: 'Part IV: System Integration & Simulation (Weeks 6-7)',
            summary: 'Integrate the trained AI model into a dynamic simulation built with OpenCV. The focus is on bridging model predictions with actionable logic and visual feedback.',
            deliverables: ['Functional Python Simulation Code', 'Integrated Real-time Detection', 'System Test Case Log']
        },
        { 
            title: 'Part V: Finalization & Dissemination (Week 8)',
            summary: 'Polish all project components, create comprehensive documentation, and prepare for the final presentation and submission of all deliverables.',
            deliverables: ['Final Project Report (PDF)', 'Demonstration Video (MP4)', 'Presentation Slides', 'Cleaned GitHub Repository']
        }
    ]
};

document.addEventListener('DOMContentLoaded', () => {
    
    const timelineCtx = document.getElementById('timelineChart').getContext('2d');
    new Chart(timelineCtx, {
        type: 'bar',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
            datasets: [
                { label: 'Initiation & Learning', data: [[0, 1]], backgroundColor: 'rgba(79, 70, 229, 0.7)', barPercentage: 0.5 },
                { label: 'Data Acquisition & Annotation', data: [[1, 3]], backgroundColor: 'rgba(5, 150, 105, 0.7)', barPercentage: 0.5 },
                { label: 'Model Development & Evaluation', data: [[3, 5]], backgroundColor: 'rgba(147, 51, 234, 0.7)', barPercentage: 0.5 },
                { label: 'System Integration & Simulation', data: [[5, 7]], backgroundColor: 'rgba(249, 115, 22, 0.7)', barPercentage: 0.5 },
                { label: 'Finalization & Dissemination', data: [[7, 8]], backgroundColor: 'rgba(51, 65, 85, 0.7)', barPercentage: 0.5 }
            ]
        },
        options: {
            indexAxis: 'y', responsive: true, maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' }, tooltip: { callbacks: { label: (c) => c.dataset.label } } },
            scales: { x: { min: 0, max: 8, grid: { color: 'rgba(203, 213, 225, 0.5)' }, ticks: { stepSize: 1, callback: (v) => 'Week ' + v } }, y: { stacked: true, grid: { display: false } } }
        }
    });

    const taskListContainer = document.getElementById('task-list');
    const roleFilterButtons = document.getElementById('role-filter-buttons');
    const phasesAccordionContainer = document.getElementById('phases-accordion');
    const riskAnalysisBtn = document.getElementById('risk-analysis-btn');
    
    const modal = document.getElementById('gemini-modal');
    const modalOverlay = document.getElementById('modal-overlay');
    const modalContent = document.getElementById('modal-content');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const modalTitle = document.getElementById('modal-title');
    const modalLoader = document.getElementById('modal-loader');
    const modalTextContent = document.getElementById('modal-text-content');
    
    function renderTasks(filter = 'all') {
        taskListContainer.innerHTML = '';
        const filteredTasks = projectData.tasks.filter(task => filter === 'all' || task.role === filter);
        
        filteredTasks.forEach(task => {
            const roleInfo = projectData.roles[task.role];
            const card = document.createElement('div');
            card.className = `task-card bg-white p-4 rounded-lg shadow-sm flex items-start gap-4 ${roleInfo.color}`;
            card.dataset.role = task.role;
            
            card.innerHTML = `
                <input type="checkbox" class="task-checkbox mt-1 h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer flex-shrink-0">
                <div class="task-content-wrapper flex-grow flex items-start gap-4">
                    <div class="flex-shrink-0 w-20 text-center">
                        <div class="font-bold text-slate-800">Week ${task.week}</div>
                        <div class="text-xs font-semibold px-2 py-1 rounded-full mt-1 ${roleInfo.color.replace('border', 'bg').replace('-500', '-100')} ${roleInfo.color.replace('border', 'text').replace('-500', '-700')}">${roleInfo.name}</div>
                    </div>
                    <div class="flex-grow">
                        <h4 class="font-bold text-slate-900">${task.title}</h4>
                        <p class="text-slate-600 text-sm">${task.description}</p>
                    </div>
                    <button class="elaborate-btn flex-shrink-0 bg-indigo-50 text-indigo-600 hover:bg-indigo-100 text-xs font-bold py-1 px-2 rounded-md transition-colors" data-title="${task.title}" data-description="${task.description}">âœ¨ Elaborate</button>
                </div>
            `;
            taskListContainer.appendChild(card);
        });
    }

    roleFilterButtons.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const role = e.target.dataset.role;
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-indigo-600', 'text-white');
                btn.classList.add('bg-white', 'text-slate-700');
            });
            e.target.classList.add('active', 'bg-indigo-600', 'text-white');
            e.target.classList.remove('bg-white', 'text-slate-700');
            renderTasks(role);
        }
    });

    function renderPhases() {
        phasesAccordionContainer.innerHTML = '';
        projectData.phases.forEach((phase) => {
            const item = document.createElement('div');
            item.className = 'bg-white rounded-lg shadow-sm overflow-hidden';
            item.innerHTML = `
                <button class="accordion-header w-full text-left p-4 flex justify-between items-center hover:bg-slate-50 focus:outline-none">
                    <span class="font-bold text-lg text-slate-800">${phase.title}</span>
                    <svg class="w-6 h-6 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="accordion-content">
                    <div class="p-4 border-t border-slate-200">
                        <p class="text-slate-600 mb-4">${phase.summary}</p>
                        <h5 class="font-semibold text-slate-700 mb-2">Key Deliverables:</h5>
                        <ul class="list-disc list-inside text-slate-600 space-y-1 mb-4">${phase.deliverables.map(d => `<li>${d}</li>`).join('')}</ul>
                        <button class="suggest-tasks-btn bg-indigo-50 text-indigo-600 hover:bg-indigo-100 text-sm font-bold py-2 px-3 rounded-md transition-colors" data-title="${phase.title}" data-summary="${phase.summary}">âœ¨ Suggest Related Tasks</button>
                    </div>
                </div>`;
            phasesAccordionContainer.appendChild(item);
        });

        document.querySelectorAll('.accordion-header').forEach(button => {
            button.addEventListener('click', () => {
                const content = button.nextElementSibling;
                const icon = button.querySelector('svg');
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                    icon.classList.remove('rotate-180');
                } else {
                    document.querySelectorAll('.accordion-content').forEach(c => c.style.maxHeight = null);
                    document.querySelectorAll('.accordion-header svg').forEach(i => i.classList.remove('rotate-180'));
                    content.style.maxHeight = content.scrollHeight + "px";
                    icon.classList.add('rotate-180');
                }
            });
        });
    }

    function showModal(title) {
        modalTitle.textContent = title;
        modalTextContent.innerHTML = '';
        modalLoader.style.display = 'flex';
        modal.classList.remove('hidden');
        setTimeout(() => {
            modalOverlay.classList.remove('opacity-0');
            modalContent.classList.remove('scale-95');
        }, 10);
    }

    function hideModal() {
        modalOverlay.classList.add('opacity-0');
        modalContent.classList.add('scale-95');
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }

    modalOverlay.addEventListener('click', hideModal);
    modalCloseBtn.addEventListener('click', hideModal);

    async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("Invalid response structure from API.");
                }
            } catch (error) {
                if (i === retries - 1) {
                    console.error("API call failed after multiple retries:", error);
                    return `Error: Could not get a response from the AI model. Please check the console for details.`;
                }
                await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
            }
        }
    }
    
    function formatResponse(text) {
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/```(.*?)```/gs, '<pre class="bg-slate-100 p-2 rounded-md text-sm"><code>$1</code></pre>')
            .replace(/`(.*?)`/g, '<code class="bg-slate-100 px-1 rounded-sm text-sm">$1</code>')
            .replace(/^(#{1,6}) (.*$)/gm, (match, h, content) => `<h${h.length + 2} class="font-bold mt-4 mb-2">${content}</h${h.length + 2}>`)
            .replace(/^\* (.*$)/gm, '<li class="ml-4">$1</li>')
            .replace(/(<\/li>\n?)(?!<li)/g, '</li></ul>')
            .replace(/<ul><li/g, '<ul><li')
            .replace(/^(?!<ul>)(<li.*<\/li>)/gm, '<ul>$1')
            .replace(/\n/g, '<br>');
    }

    taskListContainer.addEventListener('click', async (e) => {
        if (e.target.classList.contains('elaborate-btn')) {
            const button = e.target;
            const title = button.dataset.title;
            const description = button.dataset.description;

            showModal(`âœ¨ Elaborating on: ${title}`);

            const prompt = `You are an expert project manager and AI mentor. A beginner is working on the following task for an AI project.
            Task Title: "${title}"
            Task Description: "${description}"
            Please elaborate on this task. Provide a clear, actionable, step-by-step breakdown. Also, highlight potential challenges or pitfalls a beginner might face, and suggest specific, helpful resources (like documentation links, tutorials, or tools) to help them succeed. Format your response using markdown.`;

            const result = await callGeminiAPI(prompt);
            modalLoader.style.display = 'none';
            modalTextContent.innerHTML = formatResponse(result);
        }
    });
    
    taskListContainer.addEventListener('change', (e) => {
        if (e.target.classList.contains('task-checkbox')) {
            const card = e.target.closest('.task-card');
            if (card) {
                card.classList.toggle('completed');
            }
        }
    });

    riskAnalysisBtn.addEventListener('click', async () => {
        showModal('âœ¨ Analyzing Project Risks');
        const taskData = projectData.tasks.map(t => `- Week ${t.week}, ${projectData.roles[t.role].name}: ${t.title}`).join('\n');
        
        const prompt = `You are a senior project manager reviewing a plan for a team of four beginners working on an 8-week AI object detection project. Here is their task list:\n\n${taskData}\n\nAnalyze this plan and identify the top 3-5 potential risks. For each risk, explain why it's a concern (especially for beginners) and suggest a specific, actionable mitigation strategy. Focus on risks related to timeline, dependencies, skill gaps, and workload distribution. Format your response using markdown.`;
        
        const result = await callGeminiAPI(prompt);
        modalLoader.style.display = 'none';
        modalTextContent.innerHTML = formatResponse(result);
    });

    phasesAccordionContainer.addEventListener('click', async (e) => {
        if (e.target.classList.contains('suggest-tasks-btn')) {
            const button = e.target;
            const title = button.dataset.title;
            const summary = button.dataset.summary;

            showModal(`âœ¨ Suggesting Tasks for: ${title}`);

            const prompt = `You are an AI project mentor. A team of beginners is working on a project phase with the following details:
            Phase Title: "${title}"
            Phase Summary: "${summary}"
            Based on this, suggest 3-4 additional, more granular tasks that the team might have overlooked. These tasks should be practical and helpful for ensuring the phase is completed thoroughly. For each suggested task, provide a brief (1-sentence) rationale. Format your response as a markdown list.`;
            
            const result = await callGeminiAPI(prompt);
            modalLoader.style.display = 'none';
            modalTextContent.innerHTML = formatResponse(result);
        }
    });
    
    renderTasks();
    renderPhases();
});
</script>
</body>
</html>
